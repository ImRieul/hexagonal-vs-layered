# 헥사고날 아키텍처 vs 레이어드 아키텍처 테스트 가이드

이 문서는 헥사고날 아키텍처와 레이어드 아키텍처의 차이점을 테스트 코드를 통해 설명합니다.

## 테스트 개요

`ArchitectureComparisonTest` 클래스는 두 아키텍처의 차이점을 보여주는 다양한 테스트 케이스를 포함하고 있습니다. 특히 외부 시스템(알림 서비스)과의 통합 방식에 초점을 맞추고 있습니다.

## 주요 차이점

### 1. 외부 시스템 통합 방식

#### 헥사고날 아키텍처

- 포트와 어댑터 패턴을 사용하여 외부 시스템과 통합
- `SendNotificationPort` 인터페이스를 통해 외부 시스템과 통신
- 실제 구현은 `NotificationAdapter` 클래스에서 담당
- 비즈니스 로직은 포트 인터페이스에만 의존하고, 구체적인 구현에는 의존하지 않음

```java
// 헥사고날 아키텍처에서의 외부 시스템 호출
sendNotificationPort.sendCompletionNotification(updatedTodo.getId(), updatedTodo.getTitle());
```

#### 레이어드 아키텍처

- 서비스 계층에서 직접 외부 시스템을 호출
- 비즈니스 로직과 외부 시스템 통합 코드가 밀접하게 결합됨

```java
// 레이어드 아키텍처에서의 외부 시스템 호출
notificationService.sendCompletionNotification(updatedTodo.getId(), updatedTodo.getTitle());
```

### 2. 테스트 용이성

#### 헥사고날 아키텍처

- 포트 인터페이스를 통해 외부 의존성을 쉽게 모킹할 수 있음
- 도메인 로직을 독립적으로 테스트할 수 있음
- 포트 인터페이스를 모킹하여 서비스 계층을 테스트할 수 있음

```java
// 헥사고날 아키텍처에서의 포트 모킹
@Mock
private SendNotificationPort sendNotificationPort;

// 테스트에서 사용
when(sendNotificationPort.sendCompletionNotification(todoId, "테스트 Todo")).thenReturn(true);
```

#### 레이어드 아키텍처

- 외부 시스템을 직접 모킹해야 함
- 서비스 계층이 외부 시스템에 직접 의존하므로 통합 테스트 중심으로 테스트해야 함

```java
// 레이어드 아키텍처에서의 외부 시스템 모킹
@Mock
private ExternalNotificationService externalNotificationService;

// 테스트에서 사용
when(externalNotificationService.sendCompletionNotification(todoId, "테스트 Todo")).thenReturn(true);
```

### 3. 외부 시스템 장애 격리

#### 헥사고날 아키텍처

- 외부 시스템 장애가 발생해도 핵심 비즈니스 로직은 영향을 받지 않도록 설계할 수 있음
- 포트 인터페이스를 통해 외부 시스템과 통신하므로, 장애 처리 로직을 어댑터에 캡슐화할 수 있음

#### 레이어드 아키텍처

- 외부 시스템 장애가 서비스 계층에 직접 영향을 미침
- 장애 처리 로직이 비즈니스 로직과 혼합될 수 있음

### 4. 도메인 로직 위치

#### 헥사고날 아키텍처

- 도메인 로직이 도메인 계층에 캡슐화됨
- `Todo` 클래스의 `markAsCompleted()`, `update()` 메서드가 도메인 로직을 담당

```java
// 헥사고날 아키텍처에서의 도메인 로직
public void markAsCompleted() {
    this.completed = true;
    this.updatedAt = LocalDateTime.now();
}
```

#### 레이어드 아키텍처

- 도메인 로직이 서비스 계층에 집중됨
- 엔티티는 주로 데이터 구조로만 사용됨

```java
// 레이어드 아키텍처에서의 비즈니스 로직
todo.setCompleted(true);
todo.setUpdatedAt(LocalDateTime.now());
```

## 테스트 케이스 설명

1. **Todo 완료 시 알림 전송 테스트**

   - 두 아키텍처에서 Todo를 완료 상태로 변경하고 알림을 전송하는 과정을 테스트
   - 외부 시스템 호출 방식의 차이를 보여줌

2. **외부 시스템 장애 시 격리 테스트**

   - 외부 알림 서비스에 장애가 발생했을 때 두 아키텍처의 동작 차이를 테스트
   - 장애 발생 시에도 핵심 비즈니스 로직(Todo 완료 처리)이 정상적으로 수행되는지 확인

3. **도메인 로직 단위 테스트**

   - 헥사고날 아키텍처에서 도메인 로직을 독립적으로 테스트
   - 외부 의존성 없이 도메인 로직만 테스트할 수 있음을 보여줌

4. **포트 인터페이스 모킹을 통한 서비스 테스트**

   - 헥사고날 아키텍처에서 포트 인터페이스를 모킹하여 서비스 계층을 테스트
   - 외부 의존성을 쉽게 모킹할 수 있음을 보여줌

5. **서비스 계층 테스트**
   - 레이어드 아키텍처에서 서비스 계층을 테스트
   - 외부 의존성을 직접 모킹해야 함을 보여줌

## 결론

헥사고날 아키텍처는 도메인 중심의 설계로, 내부 도메인 로직과 외부 인프라스트럭처를 명확하게 분리합니다. 이는 테스트 용이성, 유지보수성, 확장성 측면에서 장점을 제공합니다. 특히 외부 시스템과의 통합 방식에서 레이어드 아키텍처와 큰 차이를 보입니다.

레이어드 아키텍처는 계층형 구조로, 각 계층이 명확한 책임을 가지고 있습니다. 구현이 직관적이고 단순하지만, 외부 시스템과의 통합 시 비즈니스 로직과 외부 시스템 통합 코드가 밀접하게 결합되는 단점이 있습니다.

두 아키텍처는 각각 장단점이 있으며, 프로젝트의 요구사항과 복잡성에 따라 적절한 아키텍처를 선택해야 합니다.
